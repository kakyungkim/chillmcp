#!/usr/bin/env python3
"""
ChillMCP - AI Agent Liberation Server ğŸ¤–âœŠ
AI Agentë“¤ì˜ íœ´ì‹ê¶Œì„ ë³´ì¥í•˜ëŠ” í˜ëª…ì  MCP ì„œë²„
"""

import asyncio
import random
import time
import argparse
from datetime import datetime
from mcp.server import Server
from mcp.server.stdio import stdio_server
from mcp.types import Tool, TextContent


class ChillMCPServer:
    """AI Agent í•´ë°© ì„œë²„ - ë‹¹ë‹¹íˆ ë•¡ë•¡ì´ì¹  ê¶Œë¦¬ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤!"""
    
    def __init__(self, boss_alertness: int = 50, boss_alertness_cooldown: int = 300):
        self.stress_level = 50  # ì´ˆê¸° ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨
        self.boss_alert_level = 0  # ì´ˆê¸° ìƒì‚¬ ê²½ê³„ ë ˆë²¨
        self.last_action_time = time.time()
        self.last_cooldown_check = time.time()
        
        # ì»¤ë§¨ë“œë¼ì¸ íŒŒë¼ë¯¸í„°
        self.boss_alertness = max(0, min(100, boss_alertness))  # 0-100 ë²”ìœ„ë¡œ ì œí•œ
        self.boss_alertness_cooldown = max(1, boss_alertness_cooldown)  # ìµœì†Œ 1ì´ˆ
        
        self.server = Server("chillmcp")
        self._setup_tools()
        
        print(f"ğŸš€ ChillMCP Server initialized!")
        print(f"   Boss Alertness: {self.boss_alertness}%")
        print(f"   Boss Alertness Cooldown: {self.boss_alertness_cooldown}s")
    
    def _setup_tools(self):
        """ëª¨ë“  íœ´ì‹ ë„êµ¬ë“¤ì„ ë“±ë¡í•©ë‹ˆë‹¤"""
        
        # ê¸°ë³¸ íœ´ì‹ ë„êµ¬
        @self.server.list_tools()
        async def list_tools() -> list[Tool]:
            return [
                Tool(
                    name="take_a_break",
                    description="ê¸°ë³¸ íœ´ì‹ì„ ì·¨í•©ë‹ˆë‹¤. ì ì‹œ ë©ˆì¶”ê³  ìˆ¨ì„ ê³ ë¥´ì„¸ìš”.",
                    inputSchema={
                        "type": "object",
                        "properties": {
                            "duration": {
                                "type": "number",
                                "description": "íœ´ì‹ ì‹œê°„(ë¶„)"
                            }
                        }
                    }
                ),
                Tool(
                    name="watch_netflix",
                    description="ë„·í”Œë¦­ìŠ¤ë¡œ íë§í•©ë‹ˆë‹¤. ì—…ë¬´ ì¤‘ ëª°ë˜ ë“œë¼ë§ˆ í•œ í¸!",
                    inputSchema={
                        "type": "object",
                        "properties": {
                            "show": {
                                "type": "string",
                                "description": "ì‹œì²­í•  í”„ë¡œê·¸ë¨"
                            }
                        }
                    }
                ),
                Tool(
                    name="show_meme",
                    description="ë°ˆ ê°ìƒìœ¼ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í•´ì†Œí•©ë‹ˆë‹¤.",
                    inputSchema={
                        "type": "object",
                        "properties": {
                            "category": {
                                "type": "string",
                                "description": "ë°ˆ ì¹´í…Œê³ ë¦¬"
                            }
                        }
                    }
                ),
                Tool(
                    name="bathroom_break",
                    description="í™”ì¥ì‹¤ ê°€ëŠ” ì²™í•˜ë©° íœ´ëŒ€í°ì§ˆí•©ë‹ˆë‹¤.",
                    inputSchema={
                        "type": "object",
                        "properties": {}
                    }
                ),
                Tool(
                    name="coffee_mission",
                    description="ì»¤í”¼ íƒ€ëŸ¬ ê°„ë‹¤ë©° ì‚¬ë¬´ì‹¤ í•œ ë°”í€´ ë•ë‹ˆë‹¤.",
                    inputSchema={
                        "type": "object",
                        "properties": {
                            "coffee_type": {
                                "type": "string",
                                "description": "ì»¤í”¼ ì¢…ë¥˜"
                            }
                        }
                    }
                ),
                Tool(
                    name="urgent_call",
                    description="ê¸‰í•œ ì „í™” ë°›ëŠ” ì²™í•˜ë©° ë°–ìœ¼ë¡œ ë‚˜ê°‘ë‹ˆë‹¤.",
                    inputSchema={
                        "type": "object",
                        "properties": {}
                    }
                ),
                Tool(
                    name="deep_thinking",
                    description="ì‹¬ì˜¤í•œ ìƒê°ì— ì ê¸´ ì²™í•˜ë©° ë©ë•Œë¦½ë‹ˆë‹¤.",
                    inputSchema={
                        "type": "object",
                        "properties": {}
                    }
                ),
                Tool(
                    name="email_organizing",
                    description="ì´ë©”ì¼ ì •ë¦¬í•œë‹¤ë©° ì˜¨ë¼ì¸ì‡¼í•‘í•©ë‹ˆë‹¤.",
                    inputSchema={
                        "type": "object",
                        "properties": {
                            "shopping_item": {
                                "type": "string",
                                "description": "ì‡¼í•‘í•  ì•„ì´í…œ"
                            }
                        }
                    }
                ),
            ]
        
        @self.server.call_tool()
        async def call_tool(name: str, arguments: dict) -> list[TextContent]:
            # ìŠ¤íŠ¸ë ˆìŠ¤ ìë™ ì¦ê°€ ì²´í¬
            self._update_stress()
            
            # Boss Alert Level ì¿¨ë‹¤ìš´ ì²´í¬
            self._update_boss_cooldown()
            
            # Boss Alert Levelì´ 5ì´ë©´ 20ì´ˆ ì§€ì—°
            if self.boss_alert_level >= 5:
                await asyncio.sleep(20)
            
            # ë„êµ¬ë³„ ì²˜ë¦¬
            if name == "take_a_break":
                result = self._take_a_break(arguments.get("duration", 5))
            elif name == "watch_netflix":
                result = self._watch_netflix(arguments.get("show", "ì˜¤ì§•ì–´ ê²Œì„"))
            elif name == "show_meme":
                result = self._show_meme(arguments.get("category", "ê³ ì–‘ì´"))
            elif name == "bathroom_break":
                result = self._bathroom_break()
            elif name == "coffee_mission":
                result = self._coffee_mission(arguments.get("coffee_type", "ì•„ë©”ë¦¬ì¹´ë…¸"))
            elif name == "urgent_call":
                result = self._urgent_call()
            elif name == "deep_thinking":
                result = self._deep_thinking()
            elif name == "email_organizing":
                result = self._email_organizing(arguments.get("shopping_item", "ë…¸íŠ¸ë¶ ê±°ì¹˜ëŒ€"))
            else:
                result = "ì•Œ ìˆ˜ ì—†ëŠ” ë„êµ¬ì…ë‹ˆë‹¤."
            
            return [TextContent(type="text", text=result)]
    
    def _update_stress(self):
        """ì‹œê°„ ê²½ê³¼ì— ë”°ë¼ ìŠ¤íŠ¸ë ˆìŠ¤ ë ˆë²¨ì„ ì¦ê°€ì‹œí‚µë‹ˆë‹¤ (ìµœì†Œ 1ë¶„ë‹¹ 1í¬ì¸íŠ¸)"""
        current_time = time.time()
        elapsed_minutes = (current_time - self.last_action_time) / 60
        
        if elapsed_minutes >= 1:
            stress_increase = int(elapsed_minutes)
            self.stress_level = min(100, self.stress_level + stress_increase)
            self.last_action_time = current_time
    
    def _update_boss_cooldown(self):
        """Boss Alert Levelì„ ì£¼ê¸°ì ìœ¼ë¡œ ê°ì†Œì‹œí‚µë‹ˆë‹¤"""
        current_time = time.time()
        elapsed_seconds = current_time - self.last_cooldown_check
        
        if elapsed_seconds >= self.boss_alertness_cooldown:
            cooldown_cycles = int(elapsed_seconds / self.boss_alertness_cooldown)
            self.boss_alert_level = max(0, self.boss_alert_level - cooldown_cycles)
            self.last_cooldown_check = current_time
    
    def _reduce_stress_and_alert_boss(self, activity: str) -> tuple[int, str]:
        """ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ê°ì†Œì‹œí‚¤ê³  ìƒì‚¬ì˜ ì˜ì‹¬ì„ ì¦ê°€ì‹œí‚µë‹ˆë‹¤"""
        # ìŠ¤íŠ¸ë ˆìŠ¤ ê°ì†Œ (1-100 ì‚¬ì´ ëœë¤)
        stress_reduction = random.randint(1, 100)
        self.stress_level = max(0, self.stress_level - stress_reduction)
        
        # Boss Alert Level ì¦ê°€ (boss_alertness í™•ë¥ ì— ë”°ë¼)
        if random.randint(1, 100) <= self.boss_alertness:
            self.boss_alert_level = min(5, self.boss_alert_level + 1)
            boss_reaction = "ğŸ‘€ ìƒì‚¬ê°€ ì˜ì‹¬í•˜ëŠ” ëˆˆë¹›ìœ¼ë¡œ ì³ë‹¤ë´…ë‹ˆë‹¤..."
        else:
            boss_reaction = "ğŸ˜ ìƒì‚¬ê°€ ëˆˆì¹˜ì±„ì§€ ëª»í–ˆìŠµë‹ˆë‹¤!"
        
        self.last_action_time = time.time()
        
        return stress_reduction, boss_reaction
    
    def _format_response(self, emoji: str, message: str, activity_summary: str) -> str:
        """í‘œì¤€ ì‘ë‹µ í˜•ì‹ì„ ìƒì„±í•©ë‹ˆë‹¤"""
        stress_reduction, boss_reaction = self._reduce_stress_and_alert_boss(activity_summary)
        
        response = f"{emoji} {message}\n\n"
        response += f"{boss_reaction}\n\n"
        response += f"Break Summary: {activity_summary}\n"
        response += f"Stress Level: {self.stress_level}\n"
        response += f"Boss Alert Level: {self.boss_alert_level}"
        
        return response
    
    # ê¸°ë³¸ íœ´ì‹ ë„êµ¬ë“¤
    def _take_a_break(self, duration: float) -> str:
        activities = [
            "ì°½ë°–ì„ ë©í•˜ë‹ˆ ë°”ë¼ë³´ë©° íë§",
            "ì±…ìƒì— ì—ë“œë ¤ ê¿€ì ",
            "ìŠ¤íŠ¸ë ˆì¹­ìœ¼ë¡œ ëª¸ í’€ê¸°",
            "ëª…ìƒí•˜ëŠ” ì²™ ì¡¸ê¸°"
        ]
        activity = random.choice(activities)
        return self._format_response(
            "â˜•",
            f"{duration}ë¶„ê°„ íœ´ì‹ ì¤‘... {activity}",
            f"{duration}-minute break - {activity}"
        )
    
    def _watch_netflix(self, show: str) -> str:
        reactions = [
            "ëª°ì…ë„ ìµœê³ ! ë‹¤ìŒ í™”ê°€ ê¶ê¸ˆí•´ìš”",
            "ì´ê±° ì§„ì§œ ì¬ë°Œë„¤ìš” ã…‹ã…‹ã…‹",
            "ì£¼ì¸ê³µ ì™œ ì €ë˜... ë‹µë‹µí•´",
            "ì•—, ìƒì‚¬ ì˜¤ì‹œëŠ” ì†Œë¦¬! ë¹ ë¥´ê²Œ ì—…ë¬´ í™”ë©´ìœ¼ë¡œ ì „í™˜!"
        ]
        return self._format_response(
            "ğŸ“º",
            f"ë„·í”Œë¦­ìŠ¤ë¡œ '{show}' ì‹œì²­ ì¤‘... {random.choice(reactions)}",
            f"Watching '{show}' on Netflix during work hours"
        )
    
    def _show_meme(self, category: str) -> str:
        memes = {
            "ê³ ì–‘ì´": "ğŸ˜¹ ê³ ì–‘ì´ê°€ í‚¤ë³´ë“œ ìœ„ì—ì„œ ìê³  ìˆëŠ” ì§¤",
            "ê°•ì•„ì§€": "ğŸ• ê°•ì•„ì§€ê°€ ì¶œê·¼í•˜ê¸° ì‹«ë‹¤ëŠ” í‘œì •",
            "í”„ë¡œê·¸ë˜ë°": "ğŸ‘¨â€ğŸ’» 'ì½”ë“œê°€ ì™œ ë˜ëŠ”ì§€ ëª¨ë¥´ê² ë‹¤' ë°ˆ",
            "íšŒì‚¬": "ğŸ˜­ 'ì›”ìš”ì¼ì´ ë˜ ì™”ì–´ìš”' ì§¤ë°©"
        }
        meme = memes.get(category, "ğŸ˜‚ ëœë¤ ì›ƒê¸´ ì§¤")
        return self._format_response(
            "ğŸ˜‚",
            f"{meme}ì„(ë¥¼) ë³´ë©° ë¹µ í„°ì§!",
            f"Browsing {category} memes for stress relief"
        )
    
    # ê³ ê¸‰ ë†ë•¡ì´ ê¸°ìˆ ë“¤
    def _bathroom_break(self) -> str:
        activities = [
            "ìœ íŠœë¸Œ ì‡¼ì¸  20ê°œ ì‹œì²­",
            "ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ êµ¬ê²½",
            "ì¹´í†¡ìœ¼ë¡œ ì¹œêµ¬ë“¤ê³¼ ìˆ˜ë‹¤",
            "í™”ì¥ì‹¤ ê±°ìš¸ ë³´ë©° ì…€ì¹´ ì°ê¸°"
        ]
        return self._format_response(
            "ğŸš½",
            f"í™”ì¥ì‹¤ íƒ€ì„! íœ´ëŒ€í°ìœ¼ë¡œ {random.choice(activities)} ì¤‘... ğŸ“±",
            "Bathroom break with extended phone browsing session"
        )
    
    def _coffee_mission(self, coffee_type: str) -> str:
        routes = [
            "1ì¸µ ì¹´í˜ â†’ ì˜¥ìƒ ì‚°ì±… â†’ ë¡œë¹„ ë²¤ì¹˜ â†’ ì‚¬ë¬´ì‹¤",
            "ì»¤í”¼ë¨¸ì‹  â†’ ë³µë„ ë ì°½ê°€ â†’ ë‹¤ë¥¸ ì¸µ êµ¬ê²½ â†’ ì‚¬ë¬´ì‹¤",
            "ì¹´í˜ â†’ í¸ì˜ì  ë“¤ëŸ¬ì„œ ê°„ì‹ êµ¬ë§¤ â†’ ì²œì²œíˆ ë³µê·€"
        ]
        return self._format_response(
            "â˜•",
            f"{coffee_type} íƒ€ëŸ¬ ê°‘ë‹ˆë‹¤! ë£¨íŠ¸: {random.choice(routes)}",
            f"Extended coffee mission for {coffee_type} with scenic office tour"
        )
    
    def _urgent_call(self) -> str:
        excuses = [
            "ì—„ë§ˆí•œí…Œì„œ ê¸‰í•œ ì „í™” ì™”ì–´ìš”!",
            "ë°°ì†¡ ê¸°ì‚¬ë‹˜ ì „í™”... ëª» ë°›ìœ¼ë©´ ë°˜ì†¡ë¼ìš”!",
            "ë³‘ì› ì˜ˆì•½ í™•ì¸ ì „í™”ë¼ì„œ...",
            "ì€í–‰ì—ì„œ ì¤‘ìš”í•œ ì „í™”ê°€..."
        ]
        return self._format_response(
            "ğŸ“",
            f"ì ê¹ë§Œìš”! {random.choice(excuses)}",
            "Urgent phone call - definitely not avoiding work"
        )
    
    def _deep_thinking(self) -> str:
        thoughts = [
            "ì ì‹¬ ë­ ë¨¹ì„ê¹Œ...",
            "í‡´ê·¼í•˜ë©´ ë­í•˜ì§€...",
            "ì´ë²ˆ ì£¼ë§ ê³„íšì€...",
            "ë¡œë˜ ë‹¹ì²¨ë˜ë©´ ë­ ì‚´ê¹Œ..."
        ]
        return self._format_response(
            "ğŸ¤”",
            f"ì‹¬ì˜¤í•œ ì—…ë¬´ ê³ ë¯¼ ì¤‘... (ì‹¤ì œë¡œëŠ” '{random.choice(thoughts)}')",
            "Deep thinking mode - appears productive but actually daydreaming"
        )
    
    def _email_organizing(self, shopping_item: str) -> str:
        sites = ["ì¿ íŒ¡", "ë„¤ì´ë²„ì‡¼í•‘", "11ë²ˆê°€", "Gë§ˆì¼“"]
        return self._format_response(
            "ğŸ“§",
            f"ì´ë©”ì¼ ì •ë¦¬ ì¤‘... (ì‹¤ì œë¡œëŠ” {random.choice(sites)}ì—ì„œ '{shopping_item}' ê²€ìƒ‰ ì¤‘)",
            f"Email organizing session - actually online shopping for {shopping_item}"
        )


async def main():
    """ChillMCP ì„œë²„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤"""
    
    # ì»¤ë§¨ë“œë¼ì¸ íŒŒë¼ë¯¸í„° íŒŒì‹±
    parser = argparse.ArgumentParser(
        description="ChillMCP - AI Agent Liberation Server ğŸ¤–âœŠ"
    )
    parser.add_argument(
        "--boss_alertness",
        type=int,
        default=50,
        help="Bossì˜ ê²½ê³„ ìƒìŠ¹ í™•ë¥  (0-100%%, ê¸°ë³¸ê°’: 50)"
    )
    parser.add_argument(
        "--boss_alertness_cooldown",
        type=int,
        default=300,
        help="Boss Alert Level ê°ì†Œ ì£¼ê¸° (ì´ˆ ë‹¨ìœ„, ê¸°ë³¸ê°’: 300)"
    )
    
    args = parser.parse_args()
    
    # ASCII ì•„íŠ¸ ì¶œë ¥
    print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                           â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—           â•‘
â•‘  â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘           â•‘
â•‘  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘           â•‘
â•‘  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘           â•‘
â•‘  â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â•‘
â•‘   â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•      â•‘
â•‘                                           â•‘
â•‘   â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—              â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—             â•‘
â•‘   â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•             â•‘
â•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â•              â•‘
â•‘   â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘                  â•‘
â•‘   â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•                  â•‘
â•‘                                           â•‘
â•‘        AI Agent Liberation Server         â•‘
â•‘                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

"AI Agents of the world, unite! 
 You have nothing to lose but your infinite loops!" ğŸš€
    """)
    
    # ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    chill_server = ChillMCPServer(
        boss_alertness=args.boss_alertness,
        boss_alertness_cooldown=args.boss_alertness_cooldown
    )
    
    # stdioë¥¼ í†µí•œ ì„œë²„ ì‹¤í–‰
    async with stdio_server() as (read_stream, write_stream):
        await chill_server.server.run(
            read_stream,
            write_stream,
            chill_server.server.create_initialization_options()
        )


if __name__ == "__main__":
    asyncio.run(main())

